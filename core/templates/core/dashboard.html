{% extends "base.html" %}
{% load humanize %}

{% block content %}
<div class="container py-4">

  <h2 class="mb-4">Dashboard</h2>

  <!-- Top row -->
  <div class="row g-4 mb-4">

    <!-- Main character -->
    <div class="col-md-6">
      <div class="card bg-dark text-light h-100">
        <div class="card-header">
          Main Character
        </div>
        <div class="card-body d-flex align-items-center gap-3">
          {% if main_char %}
            <img
              src="https://images.evetech.net/characters/{{ main_char.character_id }}/portrait?size=128"
              width="96"
              height="96"
              class="rounded"
              alt="{{ main_char.character_name }}"
              loading="lazy"
            />

            <div>
              <div class="fs-5 fw-semibold">
                {{ main_char.character_name }}
              </div>
              <div class="text-muted">
                {{ main_char.corporation_name|default:"Unknown Corp" }}<br>
                {{ main_char.alliance_name|default:"No Alliance" }}
              </div>

              <div class="mt-3">
                <a href="{% url 'link_character' %}" class="btn btn-sm btn-outline-light me-2">
                    Add Character
                </a>
                <a href="{% url 'accounts:change_main' %}" class="btn btn-sm btn-outline-light">
                    Change Main
                </a>
              </div>
            </div>
          {% else %}
            <div class="text-muted">
              No characters linked yet.
            </div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Account summary -->
    <div class="col-md-6">
      <div class="card bg-dark text-light h-100">
        <div class="card-header">
          Account Overview
        </div>
        <div class="card-body">
          <ul class="list-unstyled mb-3">
            <li><strong>Characters:</strong> {{ all_characters|length }}</li>
            <li>
              <strong>Roles:</strong>
              {% if is_reviewer %} SRP Reviewer{% endif %}
              {% if can_view_reports %}{% if is_reviewer %},{% endif %} SRP Reports{% endif %}
              {% if not is_reviewer and not can_view_reports %} Member{% endif %}
            </li>
          </ul>

        </div>
      </div>
    </div>

  </div>

  <!-- SRP actions -->
  <div class="card bg-dark text-light mb-4">
    <div class="card-header">
      SRP Quick Actions
    </div>
    <div class="card-body d-flex flex-wrap gap-2">
      <a class="btn btn-outline-light" href="{% url 'srp:submit_claim' %}">
        Submit Claim
      </a>

      <a class="btn btn-outline-light" href="{% url 'srp:my_claims' %}">
        My Claims
      </a>

      {% if is_reviewer %}
        <a class="btn btn-outline-warning" href="{% url 'srp:review_queue' %}">
          Review Queue
        </a>
      {% endif %}

      {% if can_view_reports %}
        <a class="btn btn-outline-info" href="{% url 'srp:admin_overview' %}">
          SRP Reports
        </a>
      {% endif %}
    </div>
  </div>

  <!-- Characters table -->
  <div class="card bg-dark text-light">
    <div class="card-header">
      Characters
    </div>
    <div class="table-responsive">
      <table class="table table-dark table-hover mb-0 align-middle">
        <thead>
          <tr>
            <th></th>
            <th>Name</th>
            <th>Corporation</th>
            <th>Alliance</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for c in all_characters %}
          <tr>
            <td>
              <img
                src="https://images.evetech.net/characters/{{ c.character_id }}/portrait?size=64"
                width="32"
                height="32"
                class="rounded"
                alt="{{ c.character_name }}"
                loading="lazy"
              />
            </td>
            <td>{{ c.character_name }}</td>
            <td>{{ c.corporation_name|default:"—" }}</td>
            <td>{{ c.alliance_name|default:"—" }}</td>
            <td class="text-end">
              {% if main_char and c.id == main_char.id %}
                <span class="badge bg-success">Main</span>
              {% else %}
                <span class="badge bg-secondary">Alt</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

</div>
{% endblock %}
